##Uses the cloudflare api to pull your domain zone
#Read the full documentation here: https://api.cloudflare.com/#zone-list-zones

function Get-CloudflareZone {
    param(
        [Parameter(Mandatory=0,Position=0)] [string] $EmailAddress,
        [Parameter(Mandatory=0,Position=1)] [string] $AuthKey,
        [Parameter(Mandatory=0,Position=2)] [string] $TLD
    )
    #Use provided paramters for authentication
    [hashtable] $Headers = @{
        'X-Auth-Email'=$EmailAddress
        'X-Auth-Key'=$AuthKey
    }
    #Perform Call
    $API = Invoke-WebRequest -Headers $Headers -Method Get -Uri "https://api.cloudflare.com/client/v4/zones?name=$TLD&match=all"

    #Create a hastable to make the response more readable
    $result = [Ordered]@{
    DomainName = ($API.content|ConvertFrom-Json).result.name
    ZoneID = ($API.content|ConvertFrom-Json).result.id
    StringResponse = $API.content
    JSONResponse = $API.content|ConvertFrom-Json
    AuthKey = $AuthKey
    EmailAddress = $EmailAddress
    TLD = $TLD
    }

    return $Result
}
